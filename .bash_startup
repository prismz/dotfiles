#!/bin/bash

NC='\033[0m'         # No Color (reset)
RED='\033[0;31m'
GREEN='\033[0;32m'
BLUE='\033[0;34m'
ORANGE='\033[0;33m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
LIGHTGRAY='\033[0;37m'
DARKGRAY='\033[1;30m'
LIGHTRED='\033[1;31m'
LIGHTGREEN='\033[1;32m'
YELLOW='\033[1;33m'
LIGHTBLUE='\033[1;34m'
LIGHTPURPLE='\033[1;35m'
LIGHTCYAN='\033[1;36m'
WHITE='\033[1;37m'

now_timestamp="$(date +%s)"
distro="$(grep '^ID=' /etc/os-release | cut -c4-)"

# date
echo -ne "${RED}$(uname -nr) "
uptime -p
echo -ne "${NC}"

system_creation="$(stat / -c %W)"
time_since_creation=$((now_timestamp - system_creation))
echo -e "${GREEN}System installed $(prettytime -d $time_since_creation) ago${NC}"

echo -ne "${ORANGE}Load averages (1m, 5m, 15m): "
awk '{print $1, $2, $3}' /proc/loadavg
echo -ne "${NC}"

if [ "$distro" == "gentoo" ]; then
        echo -ne "${BLUE}Portage synced "
        sync_timestamp="$(date -r /var/db/repos/gentoo/metadata/timestamp.chk +%s)"
        result_unix_ms=$((now_timestamp - sync_timestamp))
        echo -n "$(prettytime -d $result_unix_ms)"
        echo " ago"

        echo -e "$(cat /var/lib/portage/world | wc -l) packages in world, $(eix-installed -qa | wc -l) total${NC}"

        if [ "$(qlop -r 2> /dev/null | wc -l)" != "1" ]; then
                echo -n ''
        else
                echo -e "${PURPLE}Running jobs:${NC}"
                qlop -r 2> /dev/null
        fi
fi

#if [ "$(hostname)" == "spaceheater" ]; then
#        if [ "$(mount | grep 'hasan/NFS' | wc -l)" == "1" ]; then
#                echo -e "${GREEN}NFS mounted!${NC}"
#                # echo -n ''
#        else
#                echo -e "${RED}NFS not mounted! Attempting mount... ${NC}"
#
#                # I don't sudo access to stay on tty1, -N option is a one-time authentication
#                doas mount /home/hasan/NFS
#        fi
#fi

cal -3
when
